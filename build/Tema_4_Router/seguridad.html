

<!DOCTYPE html>
<html class="writer-html5" lang="es" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5.3. Seguridad. Proxy-Caché &mdash; ASIR - Servicios de Red e Internet</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/my_theme.css?v=572081c4" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=4936afed"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/translations.js?v=f85f4cfb"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="6. Servicio WEB. HTTP(S)" href="../Tema_5_Web/Index.html" />
    <link rel="prev" title="5.2. Apertura de puertos" href="puertos.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Servicios de Red e Internet
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" aria-label="Buscar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contenidos</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../PRESENTACION/Index.html">1. Presentación Módulo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../TEMA_1_Introduccion/Index.html">2. Introducción a los Servicios de Red</a></li>
<li class="toctree-l1"><a class="reference internal" href="../TEMA_2_Dhcp/Index.html">3. Protocolo de Configuración Dinámico. DHCP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tema_3_DNS/Index.html">4. Resolución de nombres. DNS</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Index.html">5. Interconexión de Redes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="acceso.html">5.1. Acceso redes remotas</a></li>
<li class="toctree-l2"><a class="reference internal" href="puertos.html">5.2. Apertura de puertos</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5.3. Seguridad. Proxy-Caché</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#squid">5.3.1. Squid</a></li>
<li class="toctree-l3"><a class="reference internal" href="#proxy-transparente">5.3.2. Proxy transparente</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Tema_5_Web/Index.html">6. Servicio WEB. HTTP(S)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tema_6_Acceso/Index.html">7. Acceso</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tema_7_Email/Index.html">8. Correo Electrónico</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tema_8_Otros/Index.html">9. Otros Servicios</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Servicios de Red e Internet</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="Index.html"><span class="section-number">5. </span>Interconexión de Redes</a></li>
      <li class="breadcrumb-item active"><span class="section-number">5.3. </span>Seguridad. Proxy-Caché</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Tema_4_Router/seguridad.rst.txt" rel="nofollow"> Ver código fuente de la página</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="seguridad-proxy-cache">
<h1><span class="section-number">5.3. </span>Seguridad. Proxy-Caché<a class="headerlink" href="#seguridad-proxy-cache" title="Link to this heading"></a></h1>
<p>Un proxy es un programa o dispositivo que realiza una acción en representación de otro. Esta situación estratégica de punto intermedio suele ser aprovechada para soportar una serie de funcionalidades:</p>
<blockquote>
<div><ul class="simple">
<li><p>PROPORCIONAR CACHÉ.</p></li>
<li><dl class="simple">
<dt>CONTROL DE ACCESO</dt><dd><ul>
<li><p>Si lo que se gestiona es el acceso desde el exterior a los recursos internos de nuestra red estaríamos hablando de un <a class="reference external" href="https://es.wikipedia.org/wiki/Proxy_inverso">proxy inverso</a>.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>REGISTRO DEL TRÁFICO</p></li>
<li><p>PROHIBIR CIERTO TIPO DE TRÁFICO.</p></li>
<li><p>REGULACION ANCHO DE BANDA</p></li>
</ul>
</div></blockquote>
<p>El uso mas común de este servicio se encuentra en Internet. Se trata de un <strong>proxy para el control del acceso a la web (principalmente los protocolos HTTP y HTTPS)</strong>, proporcionando una caché para las páginas web y los contenidos descargados. Cuando esto sucede se dice que el proxy web está haciendo un servicio de proxy-cache. Esta caché es compartida por todos los usuario del proxy, con la consiguiente mejora en los tiempos de acceso para consultas coincidentes. Al mismo tiempo libera la carga de los enlaces hacia Internet.</p>
<section id="squid">
<h2><span class="section-number">5.3.1. </span>Squid<a class="headerlink" href="#squid" title="Link to this heading"></a></h2>
<p>Vamos a estudiar uno de los proxy más ampliamente utilizado en la actualidad, <strong>SQUID</strong>, encontramos la version para Windows y para Linux. Siendo más utilizado en servidores Linux-Unix, ya que originariamente es un SW de esta platarfoma. La configuración es exactamente igual en los dos Sistemas Operativos.</p>
<p>Ya teniendo instalado nuestro servidor squid, ahora deberemos saber en donde se encuentra toda la configuración del mismo(<strong>/etc/squid</strong>). Ya dentro de esta carpeta se encontraran varios archivos pero el mas importante es el <strong>squid.conf</strong> el cual se encarga de la configuración del servicio. En la configuración de squid hay que distinguir varios elementos:</p>
<blockquote>
<div><ol class="arabic simple">
<li><dl class="simple">
<dt>Configuración General: Parámetros generales de funcionamiento del servicio.</dt><dd><ul class="simple">
<li><p>IP/Puerto donde está trabajando el servicio.</p></li>
<li><p>Tamaño de la caché.</p></li>
<li><p>etc..</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><strong>ACL (Lista de control de acceso)</strong>: Definición de conjunto de elementos a los que se aplicarán reglas.</p></li>
<li><p><strong>REGLAS</strong>: Decisiones de autorización/denegación de acceso a ACL.</p></li>
</ol>
</div></blockquote>
<p>Los recursos que podéis encontrar en la web son muchos, por ejemplo el siguiente videotutorial:</p>
<iframe width="250" style="display:block; margin-left:auto; margin-right:auto;" src="https://www.youtube.com/embed/zXusMCM6p_k" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></br><dl class="simple">
<dt>O también podéis encontrar muchísimos recursos en la web:</dt><dd><ul class="simple">
<li><p><a class="reference external" href="https://wiki.squid-cache.org/SquidFaq/SquidAcl">Wiki completa de configuración de Squid</a>.</p></li>
<li><p><a class="reference external" href="https://elpuig.xeill.net/Members/vcarceler/smx-m07/actividades/squid-a3">Unos cuantos ejemplos sencillos para comenzar</a>.</p></li>
<li><p><a class="reference external" href="http://www.squid-cache.org/Doc/config/">Documentación oficial Squid</a>.</p></li>
</ul>
</dd>
</dl>
<div class="admonition important">
<p class="admonition-title">Importante</p>
<ul class="simple">
<li><p>Puedes consultar los ficheros de registro del proxy en <em>/var/log/squid</em>.</p></li>
<li><p>Los clientes del proxy pueden configurarse de diferentes maneras.</p></li>
</ul>
</div>
<p>Para configurar los clientes que van a utilizar nuestro servicio de proxy tenemos varias opciones:</p>
<ol class="arabic">
<li><p><strong>Configuración de los navegadores</strong>: Firefox, tiene en sus configuraciones la configurar el servidor intermediario.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../_images/conProxyNavegador.png"><img alt="Configuración proxy en Firefox" class="align-center" src="../_images/conProxyNavegador.png" style="width: 200px;" />
</a>
</div></blockquote>
</li>
<li><p><strong>Proxy de sistema</strong>: Chrome u otros navegadores utilizan el proxy que se configura para todo el sistema.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../_images/conProxySistema.png"><img alt="Configuración proxy en Windows 10" class="align-center" src="../_images/conProxySistema.png" style="width: 200px;" />
</a>
</div></blockquote>
</li>
<li><p>Con un <strong>fichero de configuración automática del proxy(PAC)</strong>: Nos va a permitir automatizar algunos aspectos. Puedes ver más información en el <a class="reference external" href="https://www.watchguard.com/help/docs/help-center/es-419/Content/es-419/Fireware/proxies/explicit_proxy/explicit_proxy_pacfiles_c.html?TocPath=Controlar%20el%20Tr%C3%A1fico%20de%20Red%7CServidores%20Proxy%7CAcerca%20del%20Proxy%20Expl%C3%ADcito%7C_____4">siguiente enlace</a>.</p></li>
</ol>
<div style="text-align: justify; color: BLUE; background-color: #e0e0e0; border-radius: 25px; padding-top: 20px;padding-right: 30px;padding-bottom: 20px; padding-left: 30px;">
<u>¿Sabrías?</u></br>
¿Instalar el paquete Squid en una MV y realizar las configuraciones y pruebas pertinentes para comprobar su funcionamiento?¿Qué es lo que ocurre por defecto si no modificamos nada de la configuración inicial de Squid?
</div></br><p>La configuración de nuestro servicio proxy, consistirá en la combinación de los tres elementos vistos anteriormente. Es importante comprender varios aspectos:</p>
<ol class="arabic simple">
<li><p>Las <strong>reglas se aplican en orden</strong>. Una vez se puede aplicar una regla a un paquete, no se le aplican las siguientes (ojo con dejar un <strong>http_access allow all como regla final</strong>).</p></li>
<li><p>El uso de la <strong>negación (!)</strong> puede ayudarnos bastante en la creación de reglas, pero puede tener resultados no esperados si no la utilizamos correctamente.</p></li>
<li><p>El aplicar <strong>varias ACL a una misma regla</strong> no es lo mismo que aplicar la misma regla a cada ACL por separado.</p></li>
</ol>
<p style="text-align: justify;"><img src="https://upload.wikimedia.org/wikipedia/commons/6/68/Document_%2889367%29_-_The_Noun_Project.svg" alt="Perfil" width="50" style="vertical-align: middle; float:left;"/>
Puedes encontrar un <b>ejemplo reducido de un fichero de configuración de Squid (squid.conf) </b>, para poder trabajar con él<sup id="fnref:note1"><a class="footnote-ref" href="#fn:note1" role="doc-noteref">1</a></sup>, en el siguiente enlace:
</p><a class="reference internal image-reference" href="../_images/squid.conf"><img alt="Ejemplo fichero configuración" class="align-center" src="../_images/squid.conf" style="width: 400px;" />
</a>
<p>Sería interesante que revisaras su contenido e intentaras comprender el funcionamiento que implica.</p>
<p>Como ejemplo más básico puedes probar a configurar lo siguiente.</p>
<ol class="arabic simple">
<li><p>Autorizar el acceso a los equipos de mi red local.</p></li>
<li><p>Únicamente en horario de Servicios de Red.</p></li>
<li><p>El acceso solo se autoriza a determinadas páginas web, contenidas en un fichero de texto.</p></li>
</ol>
<p>El resultado debería ser algo parecido a lo siguiente:</p>
<a class="reference internal image-reference" href="../_images/ejemploSimple.png"><img alt="Solución al ejemplo Squid" class="align-center" src="../_images/ejemploSimple.png" style="width: 500px;" />
</a>
</section>
<section id="proxy-transparente">
<h2><span class="section-number">5.3.2. </span>Proxy transparente<a class="headerlink" href="#proxy-transparente" title="Link to this heading"></a></h2>
<p>La principal desventaja del uso de proxy es la necesidad de configurar los navegadores ”a mano”,  con la consiguiente desventaja en cuanto a seguridad y escalabilidad. La solución a esta situación pasa por la utilización de un <strong>proxy transparente</strong>. Para ello debe existir una configuración física como la que muestra la imagen.</p>
<a class="reference internal image-reference" href="../_images/proxytransparente.png"><img alt="Reenvío de puertos en SO" class="align-center" src="../_images/proxytransparente.png" style="width: 300px;" />
</a>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>La configuración de un proxy transparente presenta algunos problemas cuando hablamos de acceso HTTPS. En la web puedes encontrar bastante información al respecto.</p>
</div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">echo 1 &gt; /proc/sys/net/ipv4/ip_forward //No necesita reinicio</span>
<span class="gp">#</span>iptables<span class="w"> </span>-A<span class="w"> </span>FORWARD<span class="w"> </span>-j<span class="w"> </span>ACCEPT
<span class="gp">#</span>iptables<span class="w"> </span>-t<span class="w"> </span>nat<span class="w"> </span>-A<span class="w"> </span>POSTROUTING<span class="w"> </span>-s<span class="w"> </span><span class="m">192</span>.168.100.0/24<span class="w"> </span>-o<span class="w"> </span>eth0<span class="w"> </span>-j<span class="w"> </span>MASQUERADE
<span class="gp">#</span>iptables<span class="w"> </span>-t<span class="w"> </span>nat<span class="w"> </span>-A<span class="w"> </span>PREROUTING<span class="w"> </span>-s<span class="w"> </span><span class="m">192</span>.168.100.0/24<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">80</span><span class="w"> </span>-j<span class="w"> </span>REDIRECT<span class="w"> </span>--to-port<span class="w"> </span><span class="m">3128</span>
<span class="gp">#</span>iptables<span class="w"> </span>-t<span class="w"> </span>nat<span class="w"> </span>-A<span class="w"> </span>PREROUTING<span class="w"> </span>-s<span class="w"> </span><span class="m">192</span>.168.100.0/24<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">443</span><span class="w"> </span>-j<span class="w"> </span>REDIRECT<span class="w"> </span>--to-port<span class="w"> </span><span class="m">3128</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Importante</p>
<ul class="simple">
<li><p><strong>192.168.100.0/24</strong> es la red local de mi servidor.</p></li>
<li><p><strong>eth0</strong> es la tarjeta externa del servidor</p></li>
<li><p><strong>3128</strong> es el puerto por defecto de Squid</p></li>
</ul>
</div>
</br>
<div class="footnotes">
    <hr />
    <ol>
        <li class="footnote" id="fn:note1">
            <p>
                <b>Recuerda:</b> Haz antes de nada una copia de seguridad de tu squid.conf para evitar problemas.
            </p>
    </ol>
</div></section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pie de página">
        <a href="puertos.html" class="btn btn-neutral float-left" title="5.2. Apertura de puertos" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="../Tema_5_Web/Index.html" class="btn btn-neutral float-right" title="6. Servicio WEB. HTTP(S)" accesskey="n" rel="next">Siguiente <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Derechos de autor 2023, M. Tomás Giménez Albert.</p>
  </div>

  Compilado con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>